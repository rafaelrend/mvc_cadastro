String.prototype.replaceArray=function(a,b){var c=this;for(var x=0;x<a.length;x++){c=c.replace(a[x],b)}return c};function Configs(c){this.baseUrl=c.baseUrl;this.loadImg="<span class='loadImg'><img src='"+c.srcLoadImg+"' alt='carregando...' title='carregando...'/></span>";this.editImg=new function(){var a=document.createElement('img');a.setAttribute('class','editLine');a.setAttribute('title','Editar');a.setAttribute('alt','Editar');a.setAttribute('src',c.srcEditImg);return a};this.jQueryParams=new function(){var a=['Janeiro','Fevereiro','Marco','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novemb.','Dezembro'];var b=['Dom','Seg','Ter','Qua','Qui','Sex','Sab'];return{datePicker:{dateFormat:'dd/mm/yy',showOn:'button',buttonImage:c.baseUrl+'/public/images/calendar.png',buttonImageOnly:true,changeYear:true,monthNames:a,dayNamesMin:b}}};this.tmpJson=[]};Dialog={loadContent:function(c){$.post(configs.baseUrl+c.pageRequest,{requestDialog:true},function(a){var b=JSON.parse(a);if(b.result>0){c.dialogMsg=c.dialogMsg.replace("replaceContent",'<span style="color:#8B0000">'+b.result+'</span>');$(c.dialogElement).append(c.dialogMsg);$(c.dialogElement).dialog({show:"blind",hide:"explode"})}})}};Form={get:function(a){if(a.tagName.toLowerCase()=='form'){if(arguments[1]){arguments[1].pageRequest=a.action}inputs=a.elements}else{inputs=$('#'+a.id+' input')}return inputs},actionServer:'insert'};$.fn.extend({getHtmlForm:function(d,e){var f=function(){$(e.parentForm).prepend($(e.imgLoad));var c={};('typeForm'in arguments[0]&&typeof arguments[0].typeForm!='object')?c=arguments[0]:c={typeForm:$(this).val()};if(e.actionToForm=='edit'){for(var i in e.paramsToForm){if(i!='typeForm'){c[i]=e.paramsToForm[i]}}}c=JSON.stringify(c);$(e.parentForm).load(configs.baseUrl+e.pageRequest,{paramsToForm:c},function(){$.post(configs.baseUrl+e.pageRequestJson,{dataSendJson:'json'},function(a){var b=JSON.parse(a);for(var x in e.elementsjQueryDates){switch(e.elementsjQueryDates[x]){case'datepicker':$('#'+x).datepicker(b.jQueryParams);break;default:null;break}}if('callbackForm'in e){e.callbackForm()}})})};for(var y in d){if(d[y]=='load'){f(e.paramsToForm)}else{return this.bind(d[y],f)}}},saveForm:function(c){var d=Form.get(this.get(0),c);$(c.btnSave).click(function(e){_data=[];var a=new Object();if(e.target.type=='submit'){$(e.target.form).submit(function(){return false});e.target.type='button'}for(var i=0;i<d.length;i++){var b='';if(d[i].type=='select-one'){b=d[i].options[d[i].selectedIndex].text}else{b=d[i].value;if(!d[i].disabled||d[i].name in c.disabledExceptions){if(d[i].name){d[i].name=d[i].name.replaceArray([/[a-zA-z0-9]{1,}\[/,/\]/],'');a[d[i].name]=b}}}}for(var x in c.moreValues){a[x]=c.moreValues[x]}a['actionServer']=Form.actionServer;_data[_data.length]=a;$.sendData({msgConfirm:'Deseja salvar?',pageRequest:c.pageRequest,btnSave:e.target,loadImg:c.loadImg,onComplete:('onComplete'in c)?c.onComplete:null},_data)})},populateForm:function(a){inputs=Form.get(this.get(0));$(a.btnEdit).bind(a.eventTrigger,function(){for(var x in a.json){for(var z=0;z<inputs.length;z++){for(var y in a.json[x]){inputs[z].name=inputs[z].name.replaceArray([/[a-zA-z0-9]{1,}\[/,/\]/],'');if(a.colFilter in a.json[x]){if(inputs[z].name==y){if($(this).attr('value')==a.json[x][a.colFilter]){inputs[z].value=a.json[x][y]}if('callbackInputs'in a){inputs=a.callbackInputs(inputs)}}}for(var v in a.inputsDisabled){if(a.inputsDisabled[v]==inputs[z].name){$('#'+inputs[z].id).attr('disabled','disabled').attr('class','disabled')}}}}}if('onComplete'in a){a.onComplete(Form)}if($(this).get(0).tagName.toLowerCase()=='a'){return false}})},eraseForm:function(b){inputs=Form.get(this.get(0));var c=function(){for(var x=0;x<inputs.length;x++){if(inputs[x].value!=''){inputs[x].name=inputs[x].name.replaceArray([/[a-zA-z0-9]{1,}\[/,/\]/],'');var a=inputs[x].name in b.notErase;if(a===false){if(inputs[x].getAttribute('alt')=='decimal'){inputs[x].value='0,00'}else{if(inputs[x].disabled===true){inputs[x].disabled=false;inputs[x].className=''}inputs[x].value=''}}}}};if(b.actionTrigger=='load'){c()}else{$(b.btnErase).bind(b.actionTrigger,function(){c();$(this).hide();Form.actionServer='insert'})}},deleteForm:function(b){var c=Form.get(this.get(0),b);$(b.btnRemove).click(function(e){_data=[];var a=new Object();Form.actionServer='delete';for(var x=0;x<c.length;x++){if(c[x].name in b.elementsCond){a[c[x].name]=c[x].value}for(var y in b.moreValues){a[y]=b.moreValues[y]}}_data[_data.length]=a;_data[0]['actionServer']=Form.actionServer;$.sendData({msgConfirm:'Deseja remover?',pageRequest:b.pageRequest,btnSave:e.target,loadImg:b.loadImg,inputsRequest:c,onComplete:('onComplete'in b)?b.onComplete:null},_data)})}});$.extend({enableElement:function(a,b){$(a.btnAction).click(function(){switch(b){case'display':$(a.objDisplay).css('display','block');break;case'enable':with($(a.objDisplay)){if(css('display')=='none'){show();removeAttr('disabled');if(a.disabled===true){attr('class',$(a.objDisplay).attr('class')+' disabled');focus(function(){blur()})}('setValue'in a)?val(a.setValue):null}else{attr('disabled','disabled');hide()}}break;default:null;break}})},sendData:function(d,e){var f=JSON.stringify(e);if(f.length<=3){alert('Por favor, preencha todos os campos!!');return false}var g=confirm(d.msgConfirm);if(g){$('span:last').remove();$(d.loadImg).insertAfter($(d.btnSave));$.post(configs.baseUrl+d.pageRequest,{dataJson:f},function(a){var b=JSON.parse(a);$('.loadImg').remove();var c=/^Erro:/;if(!c.test(b.msg)){('onComplete'in d&&typeof d.onComplete=='function')?d.onComplete(b,('inputsRequest'in d)?d.inputsRequest:null):null}alert(b.msg)})}else{return false}},createOptions:function(a,b,c){if(a.length>0){$(a+' option').remove()}if(typeof b=='object'){for(var x in b){for(var y in b[x]){var d=document.createElement('option');d.value=b[x][y];d.innerHTML=b[x][y];$(a).append($(d))}}}if(c){var e=$(a+' option:last').get(0);if(typeof e!='undefined'){return e.text}else{return''}}},listBox:function(f,g){var h=[];var i=[];var j=[];var k=('msgNotSave'in f)?f.msgNotSave:'Por favor, selecione um dos novos elementos da lista antes de salvar';var l=jQuery.extend(true,{},g.editParams);var m=/\[\]/;var n=function(a,b){if(typeof a.jsonTest=='string'){b()}else{for(var w in a.jsonTest){for(var v in a.jsonTest[w]){switch(a.operatorTest){case'!=':if(a.jsonTest[w][v]!=a.valueTest){b();return false}break;case'==':if(a.jsonTest[w][v]==a.valueTest){b()}break;default:null;break}}}}};if(f.overlayOpen){$('img[rel]').overlay({expose:{color:'#444',loadSpeed:100,opacity:0.6,zIndex:9995},color:'#ccc',top:40,oneInstance:false,api:true,closeOnClick:false})}switch(f.datepicker){case true:var o='jQueryParams'in configs;if(!o){configs['jQueryParams']={datePicker:{}}}$(f.inputAdd).datepicker(configs.jQueryParams.datePicker);break;default:null;break}var p=$(f.elementList).get(0);var r=[];var s=[];if(f.action=='edit'){$(f.btnEdit).click(function(){$(g.parentImgLoad).append($(configs.loadImg));if('editValueSend'in g.editParams){g.editParams[g.editParams['keyEdit']]=g.editParams['editValueSend'];l[l['keyEdit']]=g.editParams['editValueSend']}else{g.editParams[g.editParams['keyEdit']]=$(this).attr('value');l[l['keyEdit']]=$(this).attr('value')}var b={dataJson:JSON.stringify(g.editParams)};$.post(configs.baseUrl+g.pageRequestEdit,b,function(a){s='';if(!m.test(a)){s=JSON.parse(a)}rsData=$.createOptions(f.elementList,s,true);('onCompleteDataLoad'in f)?f.onCompleteDataLoad(rsData,s):null;$('.loadImg').remove()})})}$(f.btnAdd).click(function(){var a=document.createElement('option');a.value=$(f.inputAdd).val();a.innerHTML=$(f.inputAdd).val();for(var e in p.options){if(p.options[e].text==a.value){alert('Este valor ja foi adicionado');return false}}if(p.length>0&&a.value==p.options[p.options.length-1].text){alert('Este valor ja foi adicionado')}else if(a.value==''){alert('Por favor, informe um valor')}else{$(f.elementList).append($(a));n({jsonTest:s,operatorTest:'!=',valueTest:a.value},function(){if(i.length>0){i[i.length]={dataInsert:{listBoxValue:a.value},anotherParams:g.editParams}}else{i=[{dataInsert:{listBoxValue:a.value},anotherParams:g.editParams}]}});if('onChangeDataLoad'in f){var b=$(f.elementList+' option:last').get(0).text;f.onChangeDataLoad(b,f.elementList)}}});$(f.btnRemove).click(function(){try{var a=$(p.options[p.selectedIndex]).remove()}catch(e){alert('Por favor, selecione um elemento da lista para remover');return false}if($(a).val()==$(f.otherElement).attr('rel')){$(f.otherElement).get(0).value=''}n({jsonTest:s,operatorTest:'==',valueTest:$(a).val()},function(){if(h.length>0){h[h.length]={dataDelete:$(a).val(),anotherParams:g.editParams}}else{h=[{dataDelete:$(a).val(),anotherParams:g.editParams}]}});for(var x in i){if($(a).val()==i[x]['dataInsert']){i.splice(x,1)}}if('onChangeDataLoad'in f){var b=$(f.elementList+' option:last').get(0).text;f.onChangeDataLoad(b,f.elementList)}});$(f.elementList).change(function(){if(j.length==0){j[j.length]={anotherParams:l}}for(var x in j){j[x]['anotherParams'].valueChange=$(this).val();var c=JSON.stringify(j[x]['anotherParams']);$(g.parentImgLoad).append($(configs.loadImg));$(f.otherElement).get(0).value='';$.post(configs.baseUrl+g.pageRequestOtherData,{paramsSend:c},function(a){var b=JSON.parse(a);$(f.otherElement).attr('rel',j[x]['anotherParams'].valueChange);if(b.length>0){for(var w in b){$(f.otherElement).get(0).value=b[w].valOtherElement}}else{$(f.otherElement).get(0).value=''}$('.loadImg').remove()})}});if(g){$(g.btnSave).click(function(){if('otherElement'in f){if($(p).val()===null||(h.length==0&&i.length==0)){if(h.length==0){alert(k);return false}}if(i.length>0){for(var q in i){if($(p).val()!=i[q]['dataInsert']['listBoxValue']){alert(k);return false}}}}for(var x in f.requiredFields){if($(f.otherElement).get(0).name==x&&$(f.otherElement).val()==''&&h.length==0){$('#'+x).attr('class','error').focus();alert(f.requiredFields[x]);return false}else{for(var y in i){if(i[y]['dataInsert'].listBoxValue==$(f.otherElement).attr('rel')){i[y]['dataInsert']['otherValue']=$(f.otherElement).val()}}$('#'+x).attr('class','')}}$(g.parentImgLoad).append($(configs.loadImg));var c={};if(h.length>0||i.length>0){if(h.length>0){r=i.concat(h)}else{r=i}}else{for(var x=0;x<p.length;x++){for(var y in g.diversParams){c[y]=g.diversParams[y]}c[p.name+'['+x+']']=p.options[x].text;r[0]=c}}var d=JSON.stringify(r);if(d.length<=3){alert('Por favor, adicione algum valor para salvar');$('.loadImg').remove();return false}$.post(configs.baseUrl+g.pageRequest,{dataJson:d},function(a){var b=JSON.parse(a);$('.loadImg').remove();alert(b.msg);if('onComplete'in f){if(b.msg){f.onComplete(f.paramsComplete)}}})})}}});